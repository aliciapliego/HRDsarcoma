---
title: "CIN"
author: "Alicia Pliego"
output: 
  html_document:
    toc: true
    toc_float: true
    toc_collapsed: true
    toc_depth: 3
    number_sections: true
    theme: sandstone
---

# Chromosomal Instability

Genomic instability, one of the hallmarks of cancer, is measured in many forms such as chromosomal instability, microsatellite instability, and instability characterized by increased frequency of base-pair mutations (Bakhoum and Cantley, 2018; Pikor et al., 2013; Negrini et al., 2010). Particularly, chromosomal instability (CIN) is associated with cancer progression, tumor immunity, and inflammation (Pikor et al., 2013; Bach et al., 2019). Recently, CIN has been shown to contribute to other diseases than cancer, including neurodegenerative diseases (Hou et al., 2017; Yurov et al., 2019).

```{r setup, include=FALSE, echo=FALSE, message=FALSE}
library(CINmetrics)
library(TCGAbiolinks)
library(heatmaply)
```

## Genomic Instability meassurements

### Total aberration index (tai) and Modified Total Aberration Index (taiModified)

Total Aberration Index (TAI) was proposed by (Baumbusch et al., 2013) to measure the genomic aberrations in serous ovarian cancers. TAI calculates absolute area under the curve for a copy number segment profile generated by piecewise constant fitting (PCF) algorithm. Biologically, TAI can be interpreted as absolute deviation from the normal copy number state averaged over all genomic locations. TAI provides a numerical measure in terms of both prevalence as well as the genomic size of copy number variations in tumors. One of the limitations of TAI is that since it was designed for studying advance stage ovarian tumors and short aberrations found in the early tumors have low impact on TAI. Therefore, TAI should be used to study global scale genomic disorganization that most likely occur in late stage tumors.

tai implemented in CINmetrics takes into account only those sample values that are in aberrant copy number state, i.e. has a mean segment values of less than or equal to −0.2 and greater than or equal to +0.2.

### Copy number abnormality (cna) and Counting number of break points (countingBreakPoints)

Copy Number Abnormality (CNA) was developed by (Davison et al., 2014) for studying aneuploidy in superficial gastroesophageal adenocarcinoma. An individual CNA is defined as the segment with copy number outside the predefined range of 1.7 to 2.3 with the score of 2 indicating no loss or gain (assuming that the tumor is diploid) as determined by Partek segmentation algorithm. Total CNA for the sample can thus be defined as total number of individual CNAs. CNA can be thought of as a measure of segmental aneuploidy. cna implemented in CINmetrics is similar except we define individual CNA as the segment with copy number less than equal to −0.2 and greater than equal to +0.2 with segment mean of 0 indicating no loss or gain. We chose ±0.2 as a conservative cutoff for TCGA data as described in (Laddha et al., 2014). The users can modify the cutoff by modifying segmentMean parameter.

### Counting altered base segments (countingBaseSegments) and Fraction of the genome altered (fga)

Counting altered base segments and fraction of the genome altered are modified implementation of the Genome Instability Index (GII) as described in (Chin et al., 2007). The GII was computed in two different ways, both based on calculating common regions of alteration (CRA) and both approaches showed high concordance.

fga is based on identifying common regions of alterations as fraction of the genome altered. Therefore, the fga values are normalized by dividing it by the length of the genome covered. countingBaseSegments on the other hand calculates the common regions of alteration.

### Results CINmetrics

All the metrics were computed for TCGASARC, TCGA-OV, TCGA-CRC and log10 scaled in order to compare all the meassurements between them.

#### TCGA-SARC
```{r , include=FALSE, echo=FALSE, message=FALSE}
#query.maskCNV.hg39.SARC <- GDCquery(project = "TCGA-SARC",
#              data.category = "Copy Number Variation",
#              data.type = "Masked Copy Number Segment", legacy=FALSE)
#GDCdownload(query = query.maskCNV.hg39.SARC)
#maskCNV.SARC <- GDCprepare(query = query.maskCNV.hg39.SARC, summarizedExperiment = FALSE)
#maskCNV.SARC <- data.frame(maskCNV.SARC, stringsAsFactors = FALSE)
#tai.test <- tai(cnvData = maskCNV.SARC)
```

```{r , include=FALSE, echo=FALSE, message=FALSE}
#cinmetrics_test_sarc <- CINmetrics(cnvData = maskCNV.SARC)
#head(cinmetrics_test_sarc)
#write.table(cinmetrics_test_sarc, "/Users/aliciapliego/Projects/HRDsarcoma/data/cinmetrics_sarcoma.tsv", sep="\t", quote = FALSE, row.names = F)
```

```{r , include=FALSE, echo=FALSE, message=FALSE}
#Load data from CINmetrics annotated in python
cinmetrics_sarc_anno <- read.csv('/Users/aliciapliego/Projects/HRDsarcoma/data/CINmetrics_annotated_sarc.tsv', sep = '\t')
cinmetrics_sarc_anno
cinmetrics_sarc_anno<- cinmetrics_sarc_anno[!duplicated(cinmetrics_sarc_anno), ]
```

```{r , include=FALSE, echo=FALSE, message=FALSE}
cinmetrics_sarc_anno_2 <- cinmetrics_sarc_anno 
rownames(cinmetrics_sarc_anno_2) -> cinmetrics_sarc_anno_2$sample_id
cinmetrics_sarc_anno_2$sample_id <- NULL
cinmetrics_sarc_anno_2$Tumor_type <- NULL
cinmetrics_sarc_anno_2$Sample.Type <- NULL
cinmetrics_sarc_anno_2$HRD34 <- NULL
cinmetrics_sarc_log10 <- log10(cinmetrics_sarc_anno_2)
```


##### Heatmap of the different scores 

 tai does not capture this global pattern of difference between normal and tumour samples. tai is best suited for late stage cancers, thus should be used as a measure for studying overall genomic disorganization in individual patients with advanced tumours and not as a measure of genomic instability comparison between normal and tumour samples.
 
````{r , include=FALSE, echo=FALSE, message=FALSE}
heatmaply_cor(
  cor(cinmetrics_sarc_log10),
  #xlab = "Features", 
  #ylab = "Features"
)
```

````{r , include=FALSE, echo=FALSE, message=FALSE}
row.names(cinmetrics_sarc_log10) <- cinmetrics_sarc_anno$sample_id
```

````{r , include=FALSE, echo=FALSE, message=FALSE}
heatmaply(cinmetrics_sarc_log10, 
          
  scale_fill_gradient_fun = ggplot2::scale_fill_gradient2(
    low = "blue", 
    high = "red", 
    midpoint = 200, 
    limits = c(0, 500)
  ),
  showticklabels = c(TRUE, FALSE),
  scale = "column",
  main = "TCGA-SARC CINmetrics",
  row_side_colors = cinmetrics_sarc_anno[, c("Tumor_type", "Sample.Type", "HRD34")]
  )
```


##### SINOVIAL SARCOMA (SS) Heatmap of the different scores 

```{r , include=FALSE, echo=FALSE, message=FALSE}
#Load data from CINmetrics annotated in python
cinmetrics_sarc_anno <- read.csv('/Users/aliciapliego/Projects/HRDsarcoma/data/CINmetrics_annotated_sarc_SS.tsv', sep = '\t')
cinmetrics_sarc_anno
cinmetrics_sarc_anno<- cinmetrics_sarc_anno[!duplicated(cinmetrics_sarc_anno), ]
```

```{r , include=FALSE, echo=FALSE, message=FALSE}
cinmetrics_sarc_anno_2 <- cinmetrics_sarc_anno 
rownames(cinmetrics_sarc_anno_2) -> cinmetrics_sarc_anno_2$sample_id
cinmetrics_sarc_anno_2$sample_id <- NULL
cinmetrics_sarc_anno_2$Tumor_type <- NULL
cinmetrics_sarc_anno_2$Sample.Type <- NULL
cinmetrics_sarc_anno_2$HRD34 <- NULL
cinmetrics_sarc_log10 <- log10(cinmetrics_sarc_anno_2)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
heatmaply_cor(
  cor(cinmetrics_sarc_log10),
  #xlab = "Features", 
  #ylab = "Features"
)
```

````{r , include=FALSE, echo=FALSE, message=FALSE}
row.names(cinmetrics_sarc_log10) <- cinmetrics_sarc_anno$sample_id
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
heatmaply(cinmetrics_sarc_log10, 
          
  scale_fill_gradient_fun = ggplot2::scale_fill_gradient2(
    low = "blue", 
    high = "red", 
    midpoint = 200, 
    limits = c(0, 500)
  ),
  showticklabels = c(TRUE, FALSE),
  scale = "column",
  main = "Sinovial Sarcoma (SS) TCGA-SARC CINmetrics",
  row_side_colors = cinmetrics_sarc_anno[, c( "Sample.Type", "HRD34")]
  )
```

##### UPS Heatmap of the different scores 

```{r , include=FALSE, echo=FALSE, message=FALSE}
#Load data from CINmetrics annotated in python
cinmetrics_sarc_anno <- read.csv('/Users/aliciapliego/Projects/HRDsarcoma/data/CINmetrics_annotated_sarc_UPS.tsv', sep = '\t')
cinmetrics_sarc_anno
cinmetrics_sarc_anno<- cinmetrics_sarc_anno[!duplicated(cinmetrics_sarc_anno), ]
```

```{r , include=FALSE, echo=FALSE, message=FALSE}
cinmetrics_sarc_anno_2 <- cinmetrics_sarc_anno 
rownames(cinmetrics_sarc_anno_2) -> cinmetrics_sarc_anno_2$sample_id
cinmetrics_sarc_anno_2$sample_id <- NULL
cinmetrics_sarc_anno_2$Tumor_type <- NULL
cinmetrics_sarc_anno_2$Sample.Type <- NULL
cinmetrics_sarc_anno_2$HRD34 <- NULL
cinmetrics_sarc_log10 <- log10(cinmetrics_sarc_anno_2)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
heatmaply_cor(
  cor(cinmetrics_sarc_log10),
  #xlab = "Features", 
  #ylab = "Features"
)
```

```{r , include=FALSE, echo=FALSE, message=FALSE}
row.names(cinmetrics_sarc_log10) <- cinmetrics_sarc_anno$sample_id
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
heatmaply(cinmetrics_sarc_log10, 
          
  scale_fill_gradient_fun = ggplot2::scale_fill_gradient2(
    low = "blue", 
    high = "red", 
    midpoint = 200, 
    limits = c(0, 500)
  ),
  showticklabels = c(TRUE, FALSE),
  scale = "column",
  main = "UPS TCGA-SARC CINmetrics",
  row_side_colors = cinmetrics_sarc_anno[, c( "Sample.Type", "HRD34")]
  )
```

##### MFS Heatmap of the different scores 

```{r , include=FALSE, echo=FALSE, message=FALSE}
#Load data from CINmetrics annotated in python
cinmetrics_sarc_anno <- read.csv('/Users/aliciapliego/Projects/HRDsarcoma/data/CINmetrics_annotated_sarc_MFS.tsv', sep = '\t')
cinmetrics_sarc_anno
cinmetrics_sarc_anno<- cinmetrics_sarc_anno[!duplicated(cinmetrics_sarc_anno), ]
```

```{r , include=FALSE, echo=FALSE, message=FALSE}
cinmetrics_sarc_anno_2 <- cinmetrics_sarc_anno 
rownames(cinmetrics_sarc_anno_2) -> cinmetrics_sarc_anno_2$sample_id
cinmetrics_sarc_anno_2$sample_id <- NULL
cinmetrics_sarc_anno_2$Tumor_type <- NULL
cinmetrics_sarc_anno_2$Sample.Type <- NULL
cinmetrics_sarc_anno_2$HRD34 <- NULL
cinmetrics_sarc_log10 <- log10(cinmetrics_sarc_anno_2)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
heatmaply_cor(
  cor(cinmetrics_sarc_log10),
  #xlab = "Features", 
  #ylab = "Features"
)
```

````{r , include=FALSE, echo=FALSE, message=FALSE}
row.names(cinmetrics_sarc_log10) <- cinmetrics_sarc_anno$sample_id
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
heatmaply(cinmetrics_sarc_log10, 
          
  scale_fill_gradient_fun = ggplot2::scale_fill_gradient2(
    low = "blue", 
    high = "red", 
    midpoint = 200, 
    limits = c(0, 500)
  ),
  showticklabels = c(TRUE, FALSE),
  scale = "column",
  main = "MFS TCGA-SARC CINmetrics",
  row_side_colors = cinmetrics_sarc_anno[, c( "Sample.Type", "HRD34")]
  )
```

##### ddLPS Heatmap of the different scores 

```{r , include=FALSE, echo=FALSE, message=FALSE}
#Load data from CINmetrics annotated in python
cinmetrics_sarc_anno <- read.csv('/Users/aliciapliego/Projects/HRDsarcoma/data/CINmetrics_annotated_sarc_ddLPS.tsv', sep = '\t')
cinmetrics_sarc_anno
cinmetrics_sarc_anno<- cinmetrics_sarc_anno[!duplicated(cinmetrics_sarc_anno), ]
```

```{r , include=FALSE, echo=FALSE, message=FALSE}
cinmetrics_sarc_anno_2 <- cinmetrics_sarc_anno 
rownames(cinmetrics_sarc_anno_2) -> cinmetrics_sarc_anno_2$sample_id
cinmetrics_sarc_anno_2$sample_id <- NULL
cinmetrics_sarc_anno_2$Tumor_type <- NULL
cinmetrics_sarc_anno_2$Sample.Type <- NULL
cinmetrics_sarc_anno_2$HRD34 <- NULL
cinmetrics_sarc_log10 <- log10(cinmetrics_sarc_anno_2)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
heatmaply_cor(
  cor(cinmetrics_sarc_log10),
  #xlab = "Features", 
  #ylab = "Features"
)
```

```{r , include=FALSE, echo=FALSE, message=FALSE}
row.names(cinmetrics_sarc_log10) <- cinmetrics_sarc_anno$sample_id
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
heatmaply(cinmetrics_sarc_log10, 
          
  scale_fill_gradient_fun = ggplot2::scale_fill_gradient2(
    low = "blue", 
    high = "red", 
    midpoint = 200, 
    limits = c(0, 500)
  ),
  showticklabels = c(TRUE, FALSE),
  scale = "column",
  main = "ddLPS TCGA-SARC CINmetrics",
  row_side_colors = cinmetrics_sarc_anno[, c( "Sample.Type", "HRD34")]
  )
```

##### LMS Heatmap of the different scores 

```{r , include=FALSE, echo=FALSE, message=FALSE}
#Load data from CINmetrics annotated in python
cinmetrics_sarc_anno <- read.csv('/Users/aliciapliego/Projects/HRDsarcoma/data/CINmetrics_annotated_sarc_LMS.tsv', sep = '\t')
cinmetrics_sarc_anno
cinmetrics_sarc_anno<- cinmetrics_sarc_anno[!duplicated(cinmetrics_sarc_anno), ]
```

```{r , include=FALSE, echo=FALSE, message=FALSE}
cinmetrics_sarc_anno_2 <- cinmetrics_sarc_anno 
rownames(cinmetrics_sarc_anno_2) -> cinmetrics_sarc_anno_2$sample_id
cinmetrics_sarc_anno_2$sample_id <- NULL
cinmetrics_sarc_anno_2$Tumor_type <- NULL
cinmetrics_sarc_anno_2$Sample.Type <- NULL
cinmetrics_sarc_anno_2$HRD34 <- NULL
cinmetrics_sarc_log10 <- log10(cinmetrics_sarc_anno_2)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
heatmaply_cor(
  cor(cinmetrics_sarc_log10),
  #xlab = "Features", 
  #ylab = "Features"
)
```

```{r , include=FALSE, echo=FALSE, message=FALSE}
row.names(cinmetrics_sarc_log10) <- cinmetrics_sarc_anno$sample_id
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
heatmaply(cinmetrics_sarc_log10, 
          
  scale_fill_gradient_fun = ggplot2::scale_fill_gradient2(
    low = "blue", 
    high = "red", 
    midpoint = 200, 
    limits = c(0, 500)
  ),
  showticklabels = c(TRUE, FALSE),
  scale = "column",
  main = "LMS TCGA-SARC CINmetrics",
  row_side_colors = cinmetrics_sarc_anno[, c( "Sample.Type", "HRD34")]
  )
```

##### uLMS Heatmap of the different scores 

```{r , include=FALSE, echo=FALSE, message=FALSE}
#Load data from CINmetrics annotated in python
cinmetrics_sarc_anno <- read.csv('/Users/aliciapliego/Projects/HRDsarcoma/data/CINmetrics_annotated_sarc_uLMS.tsv', sep = '\t')
cinmetrics_sarc_anno
cinmetrics_sarc_anno<- cinmetrics_sarc_anno[!duplicated(cinmetrics_sarc_anno), ]
```

```{r , include=FALSE, echo=FALSE, message=FALSE}
cinmetrics_sarc_anno_2 <- cinmetrics_sarc_anno 
rownames(cinmetrics_sarc_anno_2) -> cinmetrics_sarc_anno_2$sample_id
cinmetrics_sarc_anno_2$sample_id <- NULL
cinmetrics_sarc_anno_2$Tumor_type <- NULL
cinmetrics_sarc_anno_2$Sample.Type <- NULL
cinmetrics_sarc_anno_2$HRD34 <- NULL
cinmetrics_sarc_log10 <- log10(cinmetrics_sarc_anno_2)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
heatmaply_cor(
  cor(cinmetrics_sarc_log10),
  #xlab = "Features", 
  #ylab = "Features"
)
```

```{r , include=FALSE, echo=FALSE, message=FALSE}
row.names(cinmetrics_sarc_log10) <- cinmetrics_sarc_anno$sample_id
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
heatmaply(cinmetrics_sarc_log10, 
          
  scale_fill_gradient_fun = ggplot2::scale_fill_gradient2(
    low = "blue", 
    high = "red", 
    midpoint = 200, 
    limits = c(0, 500)
  ),
  showticklabels = c(TRUE, FALSE),
  scale = "column",
  main = "uLMS TCGA-SARC CINmetrics",
  row_side_colors = cinmetrics_sarc_anno[, c( "Sample.Type", "HRD34")]
  )
```

##### MPNST Heatmap of the different scores 

```{r , include=FALSE, echo=FALSE, message=FALSE}
#Load data from CINmetrics annotated in python
cinmetrics_sarc_anno <- read.csv('/Users/aliciapliego/Projects/HRDsarcoma/data/CINmetrics_annotated_sarc_MPNST.tsv', sep = '\t')
cinmetrics_sarc_anno
cinmetrics_sarc_anno<- cinmetrics_sarc_anno[!duplicated(cinmetrics_sarc_anno), ]
```

```{r , include=FALSE, echo=FALSE, message=FALSE}
cinmetrics_sarc_anno_2 <- cinmetrics_sarc_anno 
rownames(cinmetrics_sarc_anno_2) -> cinmetrics_sarc_anno_2$sample_id
cinmetrics_sarc_anno_2$sample_id <- NULL
cinmetrics_sarc_anno_2$Tumor_type <- NULL
cinmetrics_sarc_anno_2$Sample.Type <- NULL
cinmetrics_sarc_anno_2$HRD34 <- NULL
cinmetrics_sarc_log10 <- log10(cinmetrics_sarc_anno_2)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
heatmaply_cor(
  cor(cinmetrics_sarc_log10),
  #xlab = "Features", 
  #ylab = "Features"
)
```

```{r , include=FALSE, echo=FALSE, message=FALSE}
row.names(cinmetrics_sarc_log10) <- cinmetrics_sarc_anno$sample_id
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
heatmaply(cinmetrics_sarc_log10, 
          
  scale_fill_gradient_fun = ggplot2::scale_fill_gradient2(
    low = "blue", 
    high = "red", 
    midpoint = 200, 
    limits = c(0, 500)
  ),
  showticklabels = c(TRUE, FALSE),
  scale = "column",
  main = "MPNST TCGA-SARC CINmetrics",
  row_side_colors = cinmetrics_sarc_anno[, c( "Sample.Type", "HRD34")]
  )
```

##### DT Heatmap of the different scores 

```{r , include=FALSE, echo=FALSE, message=FALSE}
#Load data from CINmetrics annotated in python
cinmetrics_sarc_anno <- read.csv('/Users/aliciapliego/Projects/HRDsarcoma/data/CINmetrics_annotated_sarc_DT.tsv', sep = '\t')
cinmetrics_sarc_anno
cinmetrics_sarc_anno<- cinmetrics_sarc_anno[!duplicated(cinmetrics_sarc_anno), ]
```

```{r , include=FALSE, echo=FALSE, message=FALSE}
cinmetrics_sarc_anno_2 <- cinmetrics_sarc_anno 
rownames(cinmetrics_sarc_anno_2) -> cinmetrics_sarc_anno_2$sample_id
cinmetrics_sarc_anno_2$sample_id <- NULL
cinmetrics_sarc_anno_2$Tumor_type <- NULL
cinmetrics_sarc_anno_2$Sample.Type <- NULL
cinmetrics_sarc_anno_2$HRD34 <- NULL
cinmetrics_sarc_log10 <- log10(cinmetrics_sarc_anno_2)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
heatmaply_cor(
  cor(cinmetrics_sarc_log10),
  #xlab = "Features", 
  #ylab = "Features"
)
```

````{r , include=FALSE, echo=FALSE, message=FALSE}
row.names(cinmetrics_sarc_log10) <- cinmetrics_sarc_anno$sample_id
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
heatmaply(cinmetrics_sarc_log10, 
          
  scale_fill_gradient_fun = ggplot2::scale_fill_gradient2(
    low = "blue", 
    high = "red", 
    midpoint = 200, 
    limits = c(0, 500)
  ),
  showticklabels = c(TRUE, FALSE),
  scale = "column",
  main = "DT TCGA-SARC CINmetrics",
  row_side_colors = cinmetrics_sarc_anno[, c( "Sample.Type", "HRD34")]
  )
```

#### Correlation cinmetrics and HRD
```{r , include=FALSE, echo=FALSE, message=FALSE}
#Load data from CINmetrics annotated in python
cinmetrics_corr <- read.csv('/Users/aliciapliego/Projects/HRDsarcoma/data/CINmetrics_annotated_sarc_correlation_hrd.tsv', sep = '\t')
cinmetrics_corr
cinmetrics_corr<- cinmetrics_corr[!duplicated(cinmetrics_corr$sample_id), ]
```

````{r , include=FALSE, echo=FALSE, message=FALSE}
cinmetrics_corr_2 <- cinmetrics_corr 
rownames(cinmetrics_corr_2) -> cinmetrics_corr_2$sample_id
cinmetrics_corr_2$sample_id <- NULL
cinmetrics_corr_2$Tumor_type <- NULL
cinmetrics_corr_2$Sample.Type <- NULL
cinmetrics_corr_2$HRD34 <- NULL
```

```{r , include=FALSE, echo=FALSE, message=FALSE}
row.names(cinmetrics_corr_2) <- cinmetrics_corr$sample_id
```


```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
heatmaply_cor(
  cor(cinmetrics_corr_2),
  #xlab = "Features", 
  #ylab = "Features"
)
```


```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
library(plotly)

fig <- plot_ly(
  cinmetrics_corr_2, x = ~HRDscore, y = ~break_points,
  # Hover text:
  text = ~rownames(cinmetrics_corr_2),
  color = ~HRDscore, size = ~break_points
) %>% layout(title = 'HRD34 vs Breakpoints')
fig
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
fig <- plot_ly(
  cinmetrics_corr_2, x = ~HRDscore, y = ~fga,
  # Hover text:
  text = ~rownames(cinmetrics_corr_2),
  color = ~HRDscore, size = ~break_points
) %>% layout(title = 'HRD34 vs fga')
fig
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
fig <- plot_ly(
  cinmetrics_corr_2, x = ~HRDscore, y = ~tai,
  # Hover text:
  text = ~rownames(cinmetrics_corr_2),
  color = ~HRDscore, size = ~break_points
) %>% layout(title = 'HRD34 vs tai')
fig
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
fig <- plot_ly(
  cinmetrics_corr_2, x = ~HRDscore, y = ~cna,
  # Hover text:
  text = ~rownames(cinmetrics_corr_2),
  color = ~HRDscore, size = ~break_points
) %>% layout(title = 'HRD34 vs Cna')
fig
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
fig <- plot_ly(
  cinmetrics_corr_2, x = ~HRDscore, y = ~base_segments,
  # Hover text:
  text = ~rownames(cinmetrics_corr_2),
  color = ~HRDscore, size = ~break_points
) %>% layout(title = 'HRD34 vs Base_segments')
fig
```

```{r , include=FALSE, echo=FALSE, message=FALSE}
library(stats)
library(tsne)
tsne = tsne(cinmetrics_corr_2, initial_dims = 2, k =2) 
tsne <- data.frame(tsne) 
```

#### CINmetrics tSNE plot

tSNE plot showing the clustering of normal and tumor tissue including HRD34 and the CINmetrics signatures.
```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width= 7, fig.height = 7, fig.align='center'}
pdb <- cbind(tsne,cinmetrics_corr$Sample.Type)
options(warn = -1)
fig <-  plot_ly(data = pdb ,x =  ~X1, y = ~X2, type = 'scatter', mode = 'markers', split = ~cinmetrics_corr$Sample.Type)

fig <- fig %>%
  layout(
    plot_bgcolor = "#e5ecf6"
  )

fig
```


#### CONCLUSION CINmetrics 

There is a correlation between HRD34 and the CINmetric signatures except for tai, which is stated by the cinmetrics publication that is a marker of normal or tumors in an earlier stage. In some types of cancer there seems to be a correlation between low HRD and lower breakpoints and cna, however the small data set limits this conclusions and more statistics are needed.